import torch
import torch.nn as nn
import torch.optim as optim
import numpy as np

# Tiny CNN model
class TinyNet(nn.Module):
    def __init__(self):
        super().__init__()
        self.conv = nn.Conv2d(1, 2, kernel_size=3, padding=1)
        self.pool = nn.MaxPool2d(2, 2)
        self.fc = nn.Linear(2 * 16 * 16, 2)

    def forward(self, x):
        x = self.pool(torch.relu(self.conv(x)))
        x = x.view(x.size(0), -1)
        return self.fc(x)

# Synthetic dataset
X = []
y = []
for i in range(50):
    img = np.ones((32, 32), dtype=np.float32) * 0.8
    if i % 2 == 1:
        img[10:22, 10:22] = 0.05  # fake solar panel
    X.append(img)
    y.append(i % 2)

X = torch.tensor(np.array(X)).unsqueeze(1)
y = torch.tensor(y)

model = TinyNet()
criterion = nn.CrossEntropyLoss()
optimizer = optim.Adam(model.parameters(), lr=0.01)
for _ in range(10):
    optimizer.zero_grad()
    loss = criterion(model(X), y)
    loss.backward()
torch.save(model.state_dict(), "tinynet_state.pt")
print("Saved tinynet_state.pt")
